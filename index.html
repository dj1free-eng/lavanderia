<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111827" />
  <title>Lavandería · Parte Diario</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
  <header class="topbar">
    <div class="title">
      <div class="h1">Parte Diario</div>
      <div class="h2">Lavandería · offline + sync a BD_REGISTROS</div>
    </div>
    <div class="status">
      <span id="netBadge" class="badge">…</span>
      <span id="queueBadge" class="badge badge-muted">Cola: 0</span>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="row">
        <label class="label">Fecha base (sucio hoy)</label>
        <input id="fechaBase" type="date" />
      </div>

      <div class="row">
        <label class="label">Notas (opcional)</label>
        <input id="notaParte" type="text" placeholder="Incidencias, comentarios..." />
      </div>

      <div class="actions">
        <button id="btnGuardarParte" class="btn btn-primary">Guardar parte (offline)</button>
        <button id="btnSync" class="btn btn-outline">Sincronizar ahora</button>
      </div>

      <div class="mini">
        <div><strong>Fechas automáticas:</strong> Tickets = +1 día, Extra = +2 días.</div>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <div class="card-title">SUCIO EXTERNO (Jaulas)</div>
          <div class="card-subtitle">Neto = bruto − tara (42 kg por defecto)</div>
        </div>
        <button id="btnAddJaula" class="btn btn-small">+ Añadir jaula</button>
      </div>

      <div id="jaulasList" class="list"></div>

      <div class="totals">
        <div class="totrow"><span>Sábanas</span><span id="totSab">0,0 kg</span></div>
        <div class="totrow"><span>Mantelería</span><span id="totMant">0,0 kg</span></div>
        <div class="totrow totrow-strong"><span>Total sucio</span><span id="totSuci">0,0 kg</span></div>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <div class="card-title">TICKETS (Unidades)</div>
          <div class="card-subtitle">Fecha automática = mañana</div>
        </div>
        <button id="btnAddTicket" class="btn btn-small">+ Añadir línea</button>
      </div>

      <div id="ticketsList" class="list"></div>
      <div class="mini muted">Puedes meter varias líneas del mismo producto; el Sheet suma por producto.</div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <div class="card-title">EXTRA (mezcla) en bolsas</div>
          <div class="card-subtitle">Fecha automática = pasado mañana</div>
        </div>
      </div>
      <div class="row">
        <label class="label">Kilos extra (opcional)</label>
        <input id="extraKg" type="number" step="0.1" inputmode="decimal" placeholder="0.0" />
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <div class="card-title">LAVADO HOTEL</div>
          <div class="card-subtitle">Conteo por tipo y tamaño (55/24/13/8)</div>
        </div>
      </div>

      <div class="grid3">
        <div class="pill">Toalla blanca</div>
        <div class="pill">Toalla piscina</div>
        <div class="pill">Varios</div>

        <div class="lav" data-tipo="BLANCA"></div>
        <div class="lav" data-tipo="PISCINA"></div>
        <div class="lav" data-tipo="VARIOS"></div>
      </div>

      <div class="totals">
        <div class="totrow"><span>Kg blanca</span><span id="kgBlanca">0 kg</span></div>
        <div class="totrow"><span>Kg piscina</span><span id="kgPiscina">0 kg</span></div>
        <div class="totrow"><span>Kg varios</span><span id="kgVarios">0 kg</span></div>
        <div class="totrow totrow-strong"><span>Total lavado hotel</span><span id="kgHotel">0 kg</span></div>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <div class="card-title">CONTROL TOALLA PISCINA</div>
          <div class="card-subtitle">Dobladas / Subidas / Stock final</div>
        </div>
      </div>

      <div class="grid2">
        <div class="row">
          <label class="label">Dobladas</label>
          <input id="pDob" type="number" step="1" inputmode="numeric" placeholder="0" />
        </div>
        <div class="row">
          <label class="label">Subidas</label>
          <input id="pSub" type="number" step="1" inputmode="numeric" placeholder="0" />
        </div>
        <div class="row">
          <label class="label">Stock final</label>
          <input id="pSto" type="number" step="1" inputmode="numeric" placeholder="0" />
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Ajustes</div>
          <div class="card-subtitle">URL del Script + token (se guardan en este dispositivo)</div>
        </div>
      </div>

      <div class="row">
        <label class="label">Apps Script URL (Web App)</label>
        <input id="cfgUrl" type="url" placeholder="https://script.google.com/macros/s/XXXXX/exec" />
      </div>
      <div class="row">
        <label class="label">Token</label>
        <input id="cfgToken" type="password" placeholder="Tu token secreto" />
      </div>

  <div class="status-panel" id="statusPanel">
    <div class="status-row">
      <span class="status-label">Estado</span>
      <span class="status-badge" id="uiNet">—</span>
    </div>

    <div class="status-row">
      <span class="status-label">Cola</span>
      <span class="status-badge" id="uiQueue">0</span>
    </div>

    <div class="status-row">
      <span class="status-label">Último envío</span>
      <span class="status-badge" id="uiLastSent">—</span>
    </div>

    <div class="status-row">
      <span class="status-label">Verificación</span>
      <span class="status-badge" id="uiVerify">—</span>
    </div>

    <div class="status-actions">
      <button id="btnMarkVerified" class="btn btn-outline">Marcar como verificado</button>
    </div>
  </div>

  <div class="history" id="historyCard">
    <div class="history-head">
      <div class="history-title">Historial de hoy (cola)</div>
      <button id="btnRefreshHistory" class="btn btn-outline">Actualizar</button>
    </div>
    <div id="historyList" class="history-list"></div>
  </div>

      <div class="actions">
        <button id="btnSaveCfg" class="btn btn-outline">Guardar ajustes</button>
        <button id="btnExport" class="btn btn-outline">Exportar cola (JSON)</button>
        <button id="btnClear" class="btn btn-danger">Vaciar cola (cuidado)</button>
      </div>

      <pre id="log" class="log" aria-live="polite"></pre>
    </section>
  </main>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
